Если в таблице фактов содержатся триллионы строк и петабайты данных, то построение эффективных запросов становится не простой задачей. Таблицы измерений чаще меньше и насчитываются миллионами. В этом разделе будет информация основанная для хранении таблицы фактов.

Хоть в таблице фактов может быть больше 100 столбцов, аналитические запросы задействуют не более 4-5 столбцов. Рассмотрим запрос в примере ниже, он обращается к большому количеству строк, но только по 4 столбцам.

![[Pasted image 20250515232726.png]]

Как выполнить такой запрос эффективно?

В большинстве OLTP базах данных все записи одной строки находятся рядом друг с другом. В документно-ориентированных БД все происходит точно так же, весь документ обычно хранится в виде непрерывной последовательности байтов.

Чтобы выполнить запрос выше, нам понадобятся индексы по столбцам которые задействованы в запросе, которые бы помогли подсистеме хранения искать данные. Но даже после этого реализованная построчно подсистема хранения должна загрузить все строки(у каждой 100 и более столбцов) с диска в оперативную память, выполнить синтаксический разбор, отфильтровать по нужным условиям. На это может уйти уйма времени.

Идея столбцовых хранилищ проста. Нужно хранить рядом значения не из одной строки, а из одного столбца. Если каждый столбец находится в отдельном файле, то запросу требуется только прочитать и выполнить синтаксический разбор необходимых запросов, что может сэкономить кучу усилий.

Столбцовые хранилища легче понять на реляционной модели данных, но это и работает на документно-ориентированной модели данных, такое сделали Parquet, основанный на системе Dremel компании Google.

Размещение данных по столбцам требует, чтобы файлы всех столбцов содержали строки в одинаковом порядке. Следовательно, при необходимости собрать воедино целую строку можно взять из всех файлов отдельных столбцов 23-й элемент и собрать их вместе для формирования 23-й строки таблицы

[[Сжатие столбцов]]
[[Порядок сортировки в столбцовом хранилище]]
[[Запись в столбцовое хранилище]]
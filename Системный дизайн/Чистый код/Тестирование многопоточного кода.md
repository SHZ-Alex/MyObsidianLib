Правильное тестирование не гарантирует того, что ошибок в многопоточном коде не будет, но это точно сведет их к минимуму, тестирование это одно из самых сложных моментов в многопоточности.

Сделайте тесты для многопоточности качественными, чтобы они не были флаки тестами. Если происходит какая-то ошибка и тест не проходит, воспринимайте это как потенциальную угрозу и возможные ошибки.

Лучше разделить многопоточный код и этап подготовки, лучше в идеале оттестировать момент подготовки, чтобы сузить круг потенциальных проблем, не отлаживайте одновременно многопоточный и этап подготовки

Рекомендуется написать тесты, которые будут работать с разным числом потоков, 1 - 3 - 5 - 10, протестировать чтобы код взаимодействовал и с реальным кодом и с моком, отттестировать скорость, чтобы конфигурации были медленными, стандартными, быстрыми. В идеале настроить тесты так, чтобы они выполнялись заданное количество раз.

В идеале создать такую конфигурацию, чтобы её можно было менять в процессе выполнения программы или чтобы она адаптировалась к загрузке самого сервера

ОБЯЗАТЕЛЬНО написать тесты, где количество потоков будет превышать количество ядер на компьютере.

Важно знать, что многопоточность зависит от платформы, где запускается программа, если программа будет запускаться на разных платформах, в идеале протестировать и на другой платформе.

***Инструменровка кода***

Часто многопоточные ошибки могут проявиться только через день, недели, месяцы, все их отловить очень сложно, но если специально в некоторые места написать Delay, await, Yield и другие операторы в части кода, то можно эти ошибки проявить.

Лучше сделать отдельную конфигурацию, которая включала этот особый режим для тестирования, это полезно, чтобы обезопасить код от ошибок



Советы по написанию тестов
![[Pasted image 20240221233230.png]]


